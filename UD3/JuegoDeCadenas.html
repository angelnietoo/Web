<!doctype html>
<html lang="es">

<head>
    <meta charset="utf-8" />
    <title>Adivina la contraseña - código refactorizado</title>
    <style>
        body {
            font-family: Arial;
            margin: 24px;
            background: #f5f8ff
        }

        .box {
            background: #fff;
            padding: 14px;
            border-radius: 8px;
            max-width: 720px;
            margin: 0 auto;
            box-shadow: 0 6px 18px rgba(10, 20, 50, 0.06)
        }

        input,
        button {
            padding: 8px;
            border-radius: 6px;
            border: 1px solid #d7e6ff
        }

        .row {
            display: flex;
            gap: 8px;
            margin: 8px 0;
            align-items: center
        }

        .small {
            font-size: 13px;
            color: #556
        }

        .tag {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 6px;
            margin: 4px
        }

        .player-list {
            display: flex;
            gap: 8px
        }

        .played {
            opacity: 0.55;
            text-decoration: line-through
        }

        .info {
            font-size: 13px;
            color: #334;
            margin-top: 6px
        }
    </style>
</head>

<body>
    <main class="box">
        <h2>Adivina la contraseña — versión refactorizada</h2>
        <div class="small">Reglas: vocal=1, consonante=2, número=3. Comparison <strong>case-sensitive</strong>. Intentos
            ≤ longitud contraseña; se pueden enviar con menos caracteres (>=1).</div>

        <div class="row">
            <label>Contraseña: <input id="pw" type="password" value="L4ultimavezKtelod1go"></label>
            <div id="length-info" class="info"></div>
        </div>

        <div class="row player-list">
            <input id="name1" value="Jugador 1">
            <input id="name2" value="Jugador 2">
            <input id="name3" value="Jugador 3">
        </div>

        <div class="row">
            <div style="min-width:160px"><strong>Turno:</strong> <span id="current-player">Jugador 1</span></div>
            <input id="guess" placeholder="Tu intento" style="flex:1">
            <button id="go">Enviar</button>
        </div>

        <div id="out" style="margin-top:10px"></div>
        <hr />
        <div>
            <strong>Marcador:</strong>
            <div id="scores" class="small">Jugador 1: 0 — Jugador 2: 0 — Jugador 3: 0</div>
            <div id="status" class="small" style="margin-top:6px">Quedan 3 jugadores por jugar.</div>
        </div>
    </main>

    <script>
        /* Refactor: eliminar redundancias y agrupar utilidades y selectores.
           Comentarios breves; el comportamiento no cambia respecto a la versión anterior.
        */
        (() => {
            // selectores rápidos
            const $ = id => document.getElementById(id);
            const [name1, name2, name3] = [$('name1'), $('name2'), $('name3')];
            const elems = {
                pw: $('pw'), guess: $('guess'), go: $('go'), out: $('out'),
                currentPlayer: $('current-player'), scores: $('scores'), status: $('status'), lengthInfo: $('length-info'), names: [name1, name2, name3]
            };

            // estado
            const scores = [0, 0, 0];
            const played = [false, false, false];
            let current = 0; // 0..2

            // puntos por caracter (compacto)
            const charPoints = ch => /[0-9]/.test(ch) ? 3 : /[A-Za-z]/.test(ch) ? ('aeiouAEIOU'.includes(ch) ? 1 : 2) : 0;

            // render sencillo de marcador
            const renderScores = () => elems.scores.textContent = `Jugador 1: ${scores[0]} — Jugador 2: ${scores[1]} — Jugador 3: ${scores[2]}`;

            // actualiza estado visual y constraints (maxlength). centraliza la lógica para evitar repeticiones
            function renderState() {
                const remaining = played.filter(x => !x).length;
                if (!elems.pw.value.length) { elems.lengthInfo.textContent = 'Introduce una contraseña para habilitar el juego.'; elems.guess.removeAttribute('maxlength'); elems.go.disabled = true; return; }

                elems.guess.maxLength = elems.pw.value.length; // limitar a longitud contraseña
                elems.lengthInfo.textContent = `Longitud requerida: ${elems.pw.value.length} caracteres.`;

                // si todos han jugado -> finalizar
                if (remaining === 0) {
                    elems.currentPlayer.textContent = '— todos han jugado —'; elems.go.disabled = true; elems.guess.disabled = true; elems.status.textContent = 'Partida finalizada.';
                    const max = Math.max(...scores); const winners = elems.names.filter((n, i) => scores[i] === max).map(n => n.value || n.placeholder || 'Jugador');
                    elems.out.innerHTML = `<div><strong>Ganador(es):</strong> ${winners.join(', ')} — ${max} puntos</div>` + (elems.out.innerHTML || '');
                    return;
                }

                // asegurar 'current' apunta a no jugado
                if (played[current]) for (let i = 1; i <= 3; i++) { const idx = (current + i) % 3; if (!played[idx]) { current = idx; break; } }

                elems.currentPlayer.textContent = elems.names[current].value || `Jugador ${current + 1}`;
                elems.status.textContent = `Quedan ${remaining} jugador(es) por jugar.`;
                elems.names.forEach((n, i) => n.className = played[i] ? 'played' : '');

                // habilitar boton si hay al menos 1 caracter y ese jugador no ha jugado
                checkEnableSubmit();
            }

            // calcula puntuación dado intento y contraseña
            const scoreGuess = (guess, pw) => {
                let total = 0; const parts = [];
                for (const ch of guess) { const p = (pw.indexOf(ch) !== -1) ? charPoints(ch) : 0; total += p; parts.push({ ch, p, matched: p > 0 }); }
                return { parts, total };
            };

            // habilita/deshabilita botón enviar
            function checkEnableSubmit() { elems.go.disabled = !(elems.pw.value.length > 0 && !played[current] && elems.guess.value.length > 0); }

            // evento enviar
            elems.go.addEventListener('click', () => {
                const pw = elems.pw.value || '', guess = elems.guess.value || '';
                if (!pw) { alert('No hay contraseña definida.'); return; }
                if (!guess) { alert('Escribe al menos un caracter antes de enviar.'); return; }
                if (played[current]) { alert('Este jugador ya ha jugado.'); renderState(); return; }

                const res = scoreGuess(guess, pw); scores[current] += res.total; played[current] = true;
                elems.out.innerHTML = `<div><strong>${(elems.names[current].value) || `Jugador ${current + 1}`}</strong> intentó "${escapeHtml(guess)}" — puntos: ${res.total}</div>` +
                    `<div style="margin-top:6px">` + res.parts.map(p => `<span class="tag" style="background:${p.matched ? '#e6f7e6' : '#fff2f2'}">${escapeHtml(p.ch)}${p.matched ? (' +' + p.p) : ''}</span>`).join('') + `</div>` + (elems.out.innerHTML || '');

                elems.guess.value = '';
                // avanzar al siguiente no jugado
                for (let i = 1; i <= 3; i++) { const idx = (current + i) % 3; if (!played[idx]) { current = idx; break; } }
                renderScores(); renderState();
            });

            // input handlers compactos
            elems.guess.addEventListener('input', checkEnableSubmit);
            elems.pw.addEventListener('input', renderState);
            elems.guess.addEventListener('keydown', e => { if (e.key === 'Enter' && !elems.go.disabled) elems.go.click(); });

            // inicio
            renderScores(); renderState();

            function escapeHtml(s) { return String(s).replace(/[&<>\\"']/g, ch => ({ '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": "&#39;" })[ch]); }
        })();
    </script>
</body>

</html>