<!doctype html>
<html lang="es">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Ejercicios — Funciones flecha y Map (CSS básico)</title>
  <style>
    /* CSS básico y claro */
    html,
    body {
      margin: 0;
      padding: 0;
      height: 100%;
      font-family: Arial, Helvetica, sans-serif;
      font-size: 16px;
      color: #000;
      background: #fff
    }

    .container {
      max-width: 980px;
      margin: 20px auto;
      display: flex;
      gap: 16px
    }

    .col {
      flex: 1;
      padding: 12px;
      border: 1px solid #ccc;
      background: #fafafa
    }

    .col-right {
      width: 320px;
      flex: 0 0 320px
    }

    h1 {
      font-size: 18px;
      margin: 0 0 10px
    }

    label {
      display: block;
      margin: 8px 0 4px
    }

    input[type="text"],
    input[type="number"] {
      width: 100%;
      padding: 8px;
      border: 1px solid #bbb;
      border-radius: 4px
    }

    .row {
      display: flex;
      gap: 8px;
      margin-top: 8px
    }

    button {
      padding: 8px 10px;
      border: 1px solid #888;
      background: #eee;
      border-radius: 4px;
      cursor: pointer
    }

    .btn-ghost {
      background: #fff
    }

    .list {
      margin-top: 10px;
      padding: 8px;
      border: 1px solid #ddd;
      min-height: 60px;
      max-height: 360px;
      overflow: auto;
      background: #fff
    }

    .city-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 6px;
      border-bottom: 1px solid #f0f0f0
    }

    .city-name {
      font-weight: 700
    }

    .muted {
      color: #666;
      font-size: 14px
    }

    .max {
      color: #c00;
      font-weight: 800
    }

    .min {
      color: #0a7f3b;
      font-weight: 800
    }

    .small-btn {
      padding: 6px 8px;
      font-size: 13px
    }

    @media (max-width:840px) {
      .container {
        flex-direction: column
      }

      .col-right {
        width: auto;
        flex: 1
      }
    }
  </style>
</head>

<body>
  <main class="container">
    <section class="col">
      <h1>1) Función flecha aleatoria</h1>
      <label for="randMax">Introduce un número entero (n):</label>
      <input id="randMax" type="number" min="1" value="6" />
      <div class="row" style="margin-top:8px">
        <button id="btnRandom">Generar</button>
        <button class="btn-ghost" id="btnRandomClear">Borrar salida</button>
      </div>
      <div style="margin-top:8px">Resultado: <span id="randomResult" class="muted">—</span></div>

      <hr style="margin:12px 0;border:none;border-top:1px solid #eee">

      <h1>2) Calculadora</h1>
      <label>Valores:</label>
      <div class="row">
        <input id="calcA" type="number" placeholder="a" />
        <input id="calcB" type="number" placeholder="b" />
      </div>
      <div class="row" style="margin-top:8px">
        <button id="addBtn">+</button>
        <button id="subBtn">-</button>
        <button id="mulBtn">*</button>
        <button id="divBtn">/</button>
      </div>
      <div style="margin-top:8px">Resultado: <span id="calcResult" class="muted">—</span></div>
    </section>

    <aside class="col col-right">
      <h1>3) Ciudades (Map)</h1>

      <label>Agregar ciudad</label>
      <input id="cityName" type="text" placeholder="Nombre ciudad" />
      <input id="cityPop" type="number" placeholder="Habitantes (ej. 50000)" style="margin-top:6px" />

      <div class="row" style="margin-top:8px">
        <button id="addCityBtn">Añadir</button>
        <button class="btn-ghost" id="clearCitiesBtn">Vaciar</button>
      </div>

      <div style="margin-top:10px">
        <div class="row">
          <button id="showAllBtn" class="small-btn">Ver todas</button>
          <button id="countBtn" class="small-btn">Contar</button>
        </div>
        <div class="row" style="margin-top:6px">
          <button id="maxBtn" class="small-btn">Más poblada</button>
          <button id="minBtn" class="small-btn">Menos poblada</button>
        </div>
        <div style="margin-top:8px">Ciudades: <span id="cityCount" class="muted">0</span></div>
      </div>

      <div class="list" id="citiesList" aria-live="polite"></div>

      <div style="margin-top:8px" class="muted">Pulsa "Más poblada" o "Menos poblada" para resaltar.</div>
    </aside>
  </main>

  <script>
    /* 1) Función flecha aleatoria */
    const getRandomBetween1And = n => {
      const max = Math.floor(Number(n));
      if (!Number.isFinite(max) || max <= 0) return null;
      return Math.floor(Math.random() * max) + 1;
    };

    document.getElementById('btnRandom').addEventListener('click', () => {
      const n = parseInt(document.getElementById('randMax').value, 10);
      const r = getRandomBetween1And(n);
      document.getElementById('randomResult').textContent = r === null ? 'Parámetro inválido' : r;
    });
    document.getElementById('btnRandomClear').addEventListener('click', () => {
      document.getElementById('randomResult').textContent = '—';
    });

    /* 2) Calculadora (funciones flecha) */
    const add = (a, b) => a + b;
    const sub = (a, b) => a - b;
    const mul = (a, b) => a * b;
    const div = (a, b) => b === 0 ? '∞ (div/0)' : a / b;

    function getNums() {
      const a = Number(document.getElementById('calcA').value || 0);
      const b = Number(document.getElementById('calcB').value || 0);
      return { a, b };
    }

    document.getElementById('addBtn').addEventListener('click', () => {
      const { a, b } = getNums(); document.getElementById('calcResult').textContent = add(a, b);
    });
    document.getElementById('subBtn').addEventListener('click', () => {
      const { a, b } = getNums(); document.getElementById('calcResult').textContent = sub(a, b);
    });
    document.getElementById('mulBtn').addEventListener('click', () => {
      const { a, b } = getNums(); document.getElementById('calcResult').textContent = mul(a, b);
    });
    document.getElementById('divBtn').addEventListener('click', () => {
      const { a, b } = getNums(); document.getElementById('calcResult').textContent = div(a, b);
    });

    /* 3) Map de ciudades */
    const STORAGE_KEY = 'ciudades_map_v1';
    const defaultCities = new Map([['Madrid', 3223000], ['Barcelona', 1620000], ['Sevilla', 688711], ['Valencia', 794288]]);
    const loadMapFromStorage = () => {
      const raw = localStorage.getItem(STORAGE_KEY);
      if (!raw) return new Map(defaultCities);
      try { return new Map(JSON.parse(raw)); } catch { return new Map(defaultCities); }
    };
    const saveMapToStorage = map => localStorage.setItem(STORAGE_KEY, JSON.stringify(Array.from(map.entries())));
    const citiesMap = loadMapFromStorage();

    const cityNameInput = document.getElementById('cityName');
    const cityPopInput = document.getElementById('cityPop');
    const addCityBtn = document.getElementById('addCityBtn');
    const clearCitiesBtn = document.getElementById('clearCitiesBtn');
    const citiesList = document.getElementById('citiesList');
    const cityCount = document.getElementById('cityCount');
    const showAllBtn = document.getElementById('showAllBtn');
    const countBtn = document.getElementById('countBtn');
    const maxBtn = document.getElementById('maxBtn');
    const minBtn = document.getElementById('minBtn');

    function escapeHtml(str) {
      return String(str).replace(/[&<>"']/g, (m) => ({ '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": "&#39;" }[m]));
    }
    function formatNumber(n) { return Number(n).toLocaleString('es-ES'); }

    function renderCities(highlight = { type: null, key: null }) {
      citiesList.innerHTML = '';
      if (citiesMap.size === 0) {
        citiesList.textContent = 'No hay ciudades añadidas.';
        return;
      }
      citiesMap.forEach((pop, name) => {
        const item = document.createElement('div'); item.className = 'city-item';
        const left = document.createElement('div');
        const nameSpan = document.createElement('div'); nameSpan.className = 'city-name';
        nameSpan.textContent = name;
        if (highlight.type === 'max' && highlight.key === name) nameSpan.classList.add('max');
        if (highlight.type === 'min' && highlight.key === name) nameSpan.classList.add('min');
        const popSpan = document.createElement('div'); popSpan.className = 'muted'; popSpan.textContent = formatNumber(pop) + ' hab.';
        left.appendChild(nameSpan); left.appendChild(popSpan);

        const right = document.createElement('div');
        const del = document.createElement('button'); del.textContent = 'Borrar'; del.className = 'small-btn';
        del.addEventListener('click', () => {
          if (!confirm(`¿Borrar la ciudad "${name}"?`)) return;
          citiesMap.delete(name); saveMapToStorage(citiesMap); renderCities(); updateCount();
        });
        right.appendChild(del);
        item.appendChild(left); item.appendChild(right); citiesList.appendChild(item);
      });
    }

    function updateCount() { cityCount.textContent = citiesMap.size; }

    addCityBtn.addEventListener('click', () => {
      const name = (cityNameInput.value || '').trim();
      const pop = Number(cityPopInput.value);
      if (!name) return alert('Introduce un nombre de ciudad válido.');
      if (!Number.isFinite(pop) || pop < 0) return alert('Introduce un número de habitantes válido (>= 0).');
      citiesMap.set(name, Math.floor(pop));
      saveMapToStorage(citiesMap);
      cityNameInput.value = ''; cityPopInput.value = '';
      renderCities(); updateCount();
    });

    clearCitiesBtn.addEventListener('click', () => {
      if (!confirm('¿Vaciar todas las ciudades?')) return;
      citiesMap.clear(); saveMapToStorage(citiesMap); renderCities(); updateCount();
    });

    showAllBtn.addEventListener('click', () => renderCities());
    countBtn.addEventListener('click', () => { alert(`Hay ${citiesMap.size} ciudad(es) almacenada(s).`); updateCount(); });

    const findMaxCity = () => {
      if (citiesMap.size === 0) return null;
      let maxKey = null, maxVal = -Infinity;
      for (const [k, v] of citiesMap) if (v > maxVal) { maxVal = v; maxKey = k; }
      return { key: maxKey, value: maxVal };
    };
    const findMinCity = () => {
      if (citiesMap.size === 0) return null;
      let minKey = null, minVal = Infinity;
      for (const [k, v] of citiesMap) if (v < minVal) { minVal = v; minKey = k; }
      return { key: minKey, value: minVal };
    };

    maxBtn.addEventListener('click', () => {
      const max = findMaxCity(); if (!max) return alert('No hay ciudades.');
      renderCities({ type: 'max', key: max.key }); alert(`Ciudad más poblada: ${max.key} (${formatNumber(max.value)} hab.)`);
    });
    minBtn.addEventListener('click', () => {
      const min = findMinCity(); if (!min) return alert('No hay ciudades.');
      renderCities({ type: 'min', key: min.key }); alert(`Ciudad menos poblada: ${min.key} (${formatNumber(min.value)} hab.)`);
    });

    // init
    renderCities(); updateCount();

    // sync si cambian en otra pestaña
    window.addEventListener('storage', e => {
      if (e.key === STORAGE_KEY) {
        const newMap = loadMapFromStorage();
        citiesMap.clear(); for (const [k, v] of newMap) citiesMap.set(k, v);
        renderCities(); updateCount();
      }
    });
  </script>
</body>

</html>