<!doctype html>
<html lang="es">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Web Flamenco</title>
    <link rel="stylesheet" href="CSS/WebFlamenco.css">
</head>

<body>
    <div class="card">
        <h1>Palos del flamenco</h1>
        <p class="small">Selecciona un palo en el desplegable para ver sus datos (compás, tempo y tipo de letra).
            También puedes pedir solo un dato concreto. Se muestra además una visualización del compás de 1 a 12 con los
            acentos principales en negrita.</p>

        <label for="paloSelect">Elige un palo</label>
        <select id="paloSelect"></select>

        <div class="controls">
            <div>
                <label>Mostrar solo:</label>
                <select id="datoSelect">
                    <option value="all">Todos los datos</option>
                    <option value="palo">Palo</option>
                    <option value="compas">Compás</option>
                    <option value="tempo">Tempo</option>
                    <option value="letra">Tipo de letra</option>
                </select>
            </div>

            <div style="margin-left:auto">
                <button id="renderBtn">Mostrar</button>
                <button id="drawCompasBtn">Dibujar compás (1-12)</button>
            </div>
        </div>

        <div class="info" id="infoBox"></div>
        <div id="compasArea" style="margin-top:12px"></div>
        <div class="output" id="log"></div>
    </div>

    <script>
        // Datos basados en la página indicada
        const palos = [
            { name: 'Soleá', compas: '12', tempo: 'lento', letra: 'melancólica, reflexión', accents: [3, 6, 8, 10, 12], veryStrong: [3, 10, 12] },
            { name: 'Alegrías', compas: '12', tempo: 'vivo', letra: 'alegre, celebratorio', accents: [3, 6, 8, 10, 12], veryStrong: [12] },
            { name: 'Bulerías', compas: '12 (o 6)', tempo: 'muy rápida', letra: 'improvisación y festiva', accents: [12, 2, 4, 6, 8, 10], veryStrong: [1, 3, 5] },
            { name: 'Tientos', compas: '4', tempo: 'lento', letra: 'sentido y expresivo', accents: [1, 3], veryStrong: [1] },
            { name: 'Tangos', compas: '4', tempo: 'bailable, marcado', letra: 'desenfadada y festiva', accents: [1, 3], veryStrong: [1] },
            { name: 'Seguiriyas', compas: '12 (específico)', tempo: 'lento', letra: 'lamento, dolor', accents: [8, 10, 12, 3, 6], veryStrong: [8, 10, 12] },
            { name: 'Fandangos', compas: 'libre / variable', tempo: 'variable', letra: 'muy melódica; temas variados', accents: [], veryStrong: [] }
        ];

        const paloSelect = document.getElementById('paloSelect');
        const datoSelect = document.getElementById('datoSelect');
        const renderBtn = document.getElementById('renderBtn');
        const infoBox = document.getElementById('infoBox');
        const compasArea = document.getElementById('compasArea');
        const log = document.getElementById('log');
        const drawCompasBtn = document.getElementById('drawCompasBtn');

        // Rellenar desplegable
        palos.forEach((p, i) => {
            const opt = document.createElement('option');
            opt.value = i; opt.textContent = p.name;
            paloSelect.appendChild(opt);
        });

        function mostrarDatos(index, field) {
            const p = palos[index];
            if (!p) return;
            if (field === 'all') {
                infoBox.innerHTML = `<div class="field"><strong>Palo:</strong> ${p.name}</div>
                             <div class="field"><strong>Compás:</strong> ${p.compas}</div>
                             <div class="field"><strong>Tempo:</strong> ${p.tempo}</div>
                             <div class="field"><strong>Tipo de letra:</strong> ${p.letra}</div>`;
                log.textContent = `Mostrando todos los datos de ${p.name}`;
            } else {
                let text = '';
                if (field === 'palo') text = p.name;
                if (field === 'compas') text = p.compas || '—';
                if (field === 'tempo') text = p.tempo || '—';
                if (field === 'letra') text = p.letra || '—';
                infoBox.innerHTML = `<div class="field"><strong>${field.charAt(0).toUpperCase() + field.slice(1)}:</strong> ${text}</div>`;
                log.textContent = `Mostrando ${field} de ${p.name}`;
            }
        }

        function drawCompasFor(paloIndex) {
            const p = palos[paloIndex];
            compasArea.innerHTML = '';

            // If palo has '12' compas, draw 1..12. If 4 draw 1..4. If libre show message and still draw 1..12 greyed.
            const count = p.compas.includes('12') || p.compas.includes('libre') ? 12 : 4;
            const accents = new Set(p.accents);
            const very = new Set(p.veryStrong);

            const container = document.createElement('div');
            container.className = 'compas';

            for (let i = 1; i <= count; i++) {
                const span = document.createElement('div');
                span.className = 'beat';
                span.textContent = i;
                if (very.has(i)) span.classList.add('very-strong');
                else if (accents.has(i)) span.classList.add('strong');
                container.appendChild(span);
            }

            compasArea.appendChild(container);

            if (p.compas.includes('libre')) {
                const note = document.createElement('div');
                note.className = 'small';
                note.textContent = 'Este palo tiene compás libre o muy variable; los números se muestran solo como referencia.';
                compasArea.appendChild(note);
            }
        }

        // Eventos
        renderBtn.addEventListener('click', () => {
            const idx = parseInt(paloSelect.value, 10);
            const d = datoSelect.value;
            mostrarDatos(idx, d);
        });

        drawCompasBtn.addEventListener('click', () => {
            const idx = parseInt(paloSelect.value, 10);
            drawCompasFor(idx);
        });

        // Mostrar por defecto el primero
        mostrarDatos(0, 'all');
        drawCompasFor(0);
    </script>
</body>

</html>